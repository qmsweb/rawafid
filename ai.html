<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>كليم • شاتبوت</title>
  <!-- خطوط عربية من Google -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- أيقونات (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-papV7mXK0w6YJt3qQzYwJ8wq3ZLZ0nq6VnG6w3Y9VjK1hKk2/0gkYQ3QGJp2b1y0R6yQzF8Xwz1Yw==" crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <style>
    /* المتغيرات */
    :root {
        --bg: #f3f6f9;
        --card: #ffffff;
        --muted: #64748b;
        --accent: #0ea5a4;
        --text: #0f172a;
        --border: rgba(15, 23, 42, 0.04);
        --shadow: rgba(15, 23, 42, 0.06);
        
        /* أحجام الخطوط النسبية */
        --font-sm: 0.875rem;
        --font-md: 1rem;
        --font-lg: 1.125rem;
        --font-xl: 1.25rem;
    }
    
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Cairo', system-ui, Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
        min-height: 100vh;
        padding: 0.5rem;
    }
    
    /* حاوية رئيسية */
    .container {
        max-width: 920px;
        margin: 0 auto;
        padding: 1rem;
        position: relative;
    }
    
    /* شعار البوت في أعلى يمين الشاشة */
    .logo-wrap {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        z-index: 10;
    }
    
    .logo {
        width: 4.25rem;
        height: 4.25rem;
        object-fit: cover;
        border-radius: 0.75rem;
        box-shadow: 0 0.375rem 1.125rem var(--shadow);
        border: 1px solid var(--border);
    }
    
    .card {
        background: var(--card);
        border-radius: 0.875rem;
        box-shadow: 0 0.5rem 1.875rem var(--shadow);
        overflow: hidden;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1.125rem 1.25rem;
        border-bottom: 1px solid var(--border);
    }
    
    header .title {
        font-weight: 700;
        font-size: var(--font-xl);
    }
    
    header .subtitle {
        color: var(--muted);
        font-size: var(--font-sm);
    }
    
    /* مساحة المحادثة - بخلفية بيضاء */
    #chat {
        flex: 1;
        padding: 1.125rem;
        overflow: auto;
        background: linear-gradient(180deg, #ffffff, #fbfdff);
        min-height: 300px;
    }
    
    .messages {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .bubble {
        max-width: 85%;
        padding: 0.75rem 0.875rem;
        border-radius: 0.75rem;
        line-height: 1.6;
        white-space: pre-wrap;
        word-break: break-word;
    }
    
    .user {
        align-self: flex-start;
        background: #f1f5f9;
        color: var(--text);
        border: 1px solid var(--border);
    }
    
    .bot {
        align-self: flex-end;
        background: #ffffff;
        color: var(--text);
        border: 1px solid rgba(14, 165, 132, 0.08);
        box-shadow: 0 0.25rem 0.75rem rgba(14, 165, 132, 0.03);
    }
    
    /* نموذج الإرسال */
    form {
        display: flex;
        gap: 0.5rem;
        padding: 0.875rem;
        border-top: 1px solid var(--border);
        align-items: center;
    }
    
    textarea {
        flex: 1;
        min-height: 3.5rem;
        resize: vertical;
        padding: 0.625rem 0.75rem;
        border-radius: 0.625rem;
        border: 1px solid var(--border);
        font-size: var(--font-md);
        font-family: 'Cairo', sans-serif;
        max-height: 200px;
    }
    
    /* زر الإرسال أيقونة */
    .send-btn {
        width: 3.5rem;
        height: 3.5rem;
        border-radius: 0.625rem;
        display: inline-grid;
        place-items: center;
        background: var(--accent);
        color: #fff;
        border: none;
        cursor: pointer;
        flex-shrink: 0;
    }
    
    .send-btn:disabled {
        opacity: .6;
        cursor: not-allowed;
    }
    
    .meta {
        padding: 0.75rem 1.125rem;
        font-size: var(--font-sm);
        color: var(--muted);
        border-top: 1px solid var(--border);
    }
    
    /* استجابة صغيرة عند كتابة النظام */
    .system-note {
        padding: 0.625rem 1rem;
        font-size: var(--font-sm);
        color: var(--muted);
        background: linear-gradient(90deg, #f8fafc, #ffffff);
        border-top: 1px solid rgba(15, 23, 42, 0.02);
    }
    
    /* استجابات للشاشات المختلفة */
    @media (max-width: 920px) {
        .container {
            padding: 0.75rem;
        }
        
        .logo {
            width: 3.75rem;
            height: 3.75rem;
        }
        
        header .title {
            font-size: var(--font-lg);
        }
    }
    
    @media (max-width: 768px) {
        :root {
            --font-sm: 0.8125rem;
            --font-md: 0.9375rem;
            --font-lg: 1rem;
            --font-xl: 1.125rem;
        }
        
        .logo {
            width: 3.5rem;
            height: 3.5rem;
        }
        
        .bubble {
            max-width: 90%;
        }
    }
    
    @media (max-width: 640px) {
        .container {
            padding: 0.5rem;
        }
        
        .logo-wrap {
            position: relative;
            top: 0;
            right: 0;
            display: flex;
            justify-content: center;
            margin-bottom: 0.5rem;
        }
        
        header {
            flex-direction: column;
            text-align: center;
            gap: 0.25rem;
            padding: 0.875rem;
        }
        
        #chat {
            padding: 0.75rem;
        }
        
        .bubble {
            max-width: 95%;
            padding: 0.625rem 0.75rem;
        }
        
        form {
            padding: 0.625rem;
        }
        
        textarea {
            min-height: 3rem;
            font-size: var(--font-sm);
        }
        
        .send-btn {
            width: 3rem;
            height: 3rem;
        }
    }
    
    @media (max-width: 480px) {
        .card {
            border-radius: 0.75rem;
        }
        
        .bubble {
            max-width: 100%;
        }
        
        .meta {
            padding: 0.5rem;
            text-align: center;
        }
    }
    
    /* تحسينات للأجهزة الصغيرة جداً */
    @media (max-width: 360px) {
        :root {
            --font-sm: 0.75rem;
            --font-md: 0.875rem;
            --font-lg: 0.9375rem;
            --font-xl: 1rem;
        }
        
        form {
            flex-direction: column;
        }
        
        textarea {
            width: 100%;
        }
        
        .send-btn {
            width: 100%;
            height: 2.75rem;
        }
    }
    </style>

</head>
<body>
  <div class="container">
    <div class="logo-wrap">
      <img src="/images/favicon.png"  class="logo" />
    </div>

    <div class="card" role="application">
      <header>
        <div>
          <div class="title">كليم</div>
          <div class="subtitle">مساعد في التربية واللغة العربية</div>
        </div>
        <div style="margin-inline-start:auto; text-align:left">
          <small class="meta">المسار: <code>https://api.groq.com/openai/v1/chat/completions</code></small>
        </div>
      </header>

      <div id="chat" aria-live="polite">
        <div class="messages" id="messages"></div>
      </div>

      <form id="sendForm" autocomplete="off">
        <textarea id="prompt" placeholder="اكتب رسالتك هنا..." required></textarea>
        <button type="submit" class="send-btn" id="sendBtn" title="إرسال"><i class="fa-solid fa-paper-plane" style="font-size:18px"></i></button>
      </form>

      <div class="system-note">ملاحظة: هذا الملف يحتوي على مفتاح API داخل الكود — استبدله قبل الاستخدام ويفضل وضعه في خادم وسيط لإخفائه.</div>
    </div>
  </div>

  <script>
    /***** اضف مفتاحك هنا (استبدله بقيمة حقيقية) *****/
    const GROQ_API_KEY = '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'; // <-- ضع مفتاحك هنا

    /* شخصية كليم (رسالة النظام) */
    const systemMessage = {
      role: 'system',
      content: `اسمك هو "كليم".\nأنت مساعد أكاديمي متخصص فقط في مجال التربية واللغة العربية.\nأجب دائمًا بالعربية الفصحى وبشكل واضح ومختصر.\nإذا طرح المستخدم سؤالًا خارج هذين المجالين، اجب بلباقة: "أنا مختص بالتربية واللغة العربية فقط".`
    };

    // مصفوفة المحادثة تحفظ الرسائل التي سترسل إلى الـ API
    const conversation = [ systemMessage ];

    const messagesEl = document.getElementById('messages');
    const form = document.getElementById('sendForm');
    const promptEl = document.getElementById('prompt');
    const sendBtn = document.getElementById('sendBtn');

    function addBubble(text, who='user'){
      const div = document.createElement('div');
      div.className = 'bubble ' + (who === 'user' ? 'user' : 'bot');
      div.textContent = text;
      messagesEl.appendChild(div);
      // تمرير للعرض
      const chat = document.getElementById('chat');
      chat.scrollTop = chat.scrollHeight;
    }

    async function callGroqAPI(messages){
      if (!GROQ_API_KEY || GROQ_API_KEY === 'REPLACE_WITH_YOUR_API_KEY'){
        throw new Error('ضع مفتاح Groq API في المتغير GROQ_API_KEY داخل الكود.');
      }

      const body = {
        model: 'llama-3.3-70b-versatile',
        messages: messages,
        temperature: 0.25,
        stream: false
      };

      const resp = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + GROQ_API_KEY
        },
        body: JSON.stringify(body)
      });

      if (!resp.ok){
        const txt = await resp.text().catch(()=>resp.statusText);
        throw new Error('خطأ من الخادم: ' + resp.status + ' — ' + txt);
      }

      const data = await resp.json();
      const reply = data?.choices?.[0]?.message?.content || '';
      return reply.trim();
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const text = promptEl.value.trim();
      if (!text) return;

      // إضافة فقاعة المستخدم
      addBubble(text, 'user');
      conversation.push({ role: 'user', content: text });

      // تعطيل الإدخال أثناء الطلب
      promptEl.value = '';
      promptEl.disabled = true;
      sendBtn.disabled = true;

      try{
        const reply = await callGroqAPI(conversation);
        // إضافة فقاعة البوت
        addBubble(reply || '—', 'bot');
        conversation.push({ role: 'assistant', content: reply });
      }catch(err){
        addBubble('خطأ: ' + err.message, 'bot');
      }finally{
        promptEl.disabled = false;
        sendBtn.disabled = false;
        promptEl.focus();
      }
    });

    // ترحيب افتراضي يظهر عند فتح الصفحة
    window.addEventListener('load', ()=>{
      addBubble('مرحبًا — أنا كليم، مساعدك المتخصص في التربية واللغة العربية. كيف أساعدك اليوم؟', 'bot');
    });
  </script>
</body>
</html>
