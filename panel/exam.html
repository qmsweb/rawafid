<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ (Drag & Drop)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f0f2f5; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª */
        .ghost-class { opacity: 0.5; background: #e0e7ff; border: 2px dashed #4f46e5; }
        .drag-handle { cursor: grab; touch-action: none; }
        .drag-handle:active { cursor: grabbing; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª */
        .question-card { transition: all 0.2s ease; }
        .question-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* Ø²Ø± Ø¹Ø§Ø¦Ù… */
        .fab-btn {
            position: fixed; bottom: 30px; left: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 50;
        }
    </style>
</head>
<body class="pb-24">

    <header class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
                <span class="text-blue-600 text-3xl">ğŸ› ï¸</span> Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
            </h1>
            <div class="flex gap-2">
                <button onclick="document.getElementById('importModal').classList.remove('hidden')" class="text-sm bg-gray-100 text-gray-700 px-3 py-2 rounded-lg hover:bg-gray-200 transition font-medium">
                    ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒÙˆØ¯
                </button>
                <button onclick="generateYAML()" class="text-sm bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition font-bold shadow-lg shadow-blue-200">
                    ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©
                </button>
            </div>
        </div>
    </header>

    <div class="max-w-5xl mx-auto p-4 space-y-6">

        <section class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-3 mb-2">
                <h2 class="text-lg font-bold text-gray-700 border-b pb-2">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-500 mb-1">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                <input type="text" id="meta-title" class="w-full p-2 bg-gray-50 border border-gray-200 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-500 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                <input type="text" id="meta-subject" class="w-full p-2 bg-gray-50 border border-gray-200 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ù…Ø«Ø§Ù„: Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-500 mb-1">Ø±Ù…Ø² Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                <input type="text" id="meta-code" class="w-full p-2 bg-gray-50 border border-gray-200 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="ARB101">
            </div>
        </section>

        <div id="questions-list" class="space-y-4 min-h-[200px]">
            </div>

        <div id="empty-state" class="text-center py-12 text-gray-400 bg-white rounded-xl border-2 border-dashed border-gray-200">
            <p class="text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯</p>
            <p class="text-sm mt-2">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</p>
        </div>

    </div>

    <button onclick="addQuestion()" class="fab-btn bg-green-600 hover:bg-green-700 text-white w-14 h-14 rounded-full flex items-center justify-center text-3xl transition transform hover:scale-110">
        +
    </button>

    <div id="importModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl p-6 m-4">
            <h3 class="text-lg font-bold mb-4">Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒÙˆØ¯ YAML</h3>
            <textarea id="importText" class="w-full h-64 p-3 bg-gray-900 text-green-400 font-mono text-sm rounded-lg ltr" dir="ltr" placeholder="Ø¶Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§..."></textarea>
            <div class="flex justify-end gap-3 mt-4">
                <button onclick="document.getElementById('importModal').classList.add('hidden')" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="processImport()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ØªØ­Ù„ÙŠÙ„ ÙˆØ¨Ù†Ø§Ø¡</button>
            </div>
        </div>
    </div>

    <div id="exportModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl p-6 m-4 border-t-4 border-green-500">
            <h3 class="text-lg font-bold mb-4 flex justify-between">
                <span>Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span>
                <button onclick="copyToClipboard()" class="text-sm text-blue-600 hover:underline">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
            </h3>
            <textarea id="exportText" readonly class="w-full h-64 p-3 bg-gray-50 text-gray-800 font-mono text-sm rounded-lg border ltr" dir="ltr"></textarea>
            <div class="flex justify-end gap-3 mt-4">
                <button onclick="document.getElementById('exportModal').classList.add('hidden')" class="px-6 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        // === ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª ===
        const listContainer = document.getElementById('questions-list');
        new Sortable(listContainer, {
            handle: '.drag-handle', // Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙ‚Ø·
            animation: 150,
            ghostClass: 'ghost-class',
            onEnd: function() {
                renumberQuestions(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­Ø¨
            }
        });

        let questionCount = 0;

        // === Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===

        function addQuestion(data = null) {
            document.getElementById('empty-state').classList.add('hidden');
            questionCount++;
            
            const id = Date.now() + Math.random().toString(36).substr(2, 9);
            const qData = data || { type: 'mcq', points: 1, choices: ['', ''], answer: '', question: '' };

            const card = document.createElement('div');
            card.className = 'question-card bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden';
            card.id = `card-${id}`;
            card.innerHTML = `
                <div class="bg-gray-50 p-3 border-b flex justify-between items-center select-none">
                    <div class="flex items-center gap-3">
                        <span class="drag-handle cursor-grab text-gray-400 hover:text-gray-600 p-1">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
                        </span>
                        <span class="font-bold text-gray-700 q-number">Ø³${questionCount}</span>
                        <select class="text-sm border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" 
                                onchange="changeType('${id}', this.value)">
                            <option value="mcq" ${qData.type === 'mcq' ? 'selected' : ''}>Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                            <option value="tf" ${qData.type === 'tf' ? 'selected' : ''}>ØµÙˆØ§Ø¨/Ø®Ø·Ø£</option>
                            <option value="essay" ${qData.type === 'essay' ? 'selected' : ''}>Ù…Ù‚Ø§Ù„ÙŠ</option>
                            <option value="instructions" ${qData.type === 'instructions' ? 'selected' : ''}>ØªØ¹Ù„ÙŠÙ…Ø§Øª/ÙØ§ØµÙ„</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-2">
                         <button onclick="toggleCollapse('${id}')" class="text-gray-400 hover:text-blue-600 p-1" title="Ø·ÙŠ/ØªÙˆØ³ÙŠØ¹">
                            <svg class="w-5 h-5 transform transition-transform" id="icon-collapse-${id}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <button onclick="deleteQuestion('${id}')" class="text-gray-400 hover:text-red-600 p-1" title="Ø­Ø°Ù">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                </div>

                <div id="body-${id}" class="p-4 space-y-4">
                    <div class="flex gap-4 ${qData.type === 'instructions' ? 'hidden' : ''}" id="common-fields-${id}">
                        <div class="flex-grow">
                            <label class="text-xs font-bold text-gray-500">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                            <input type="text" class="q-text w-full p-2 border rounded focus:ring-1 focus:ring-blue-500 outline-none" value="${qData.question || ''}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§...">
                        </div>
                        <div class="w-24">
                            <label class="text-xs font-bold text-gray-500">Ø§Ù„Ø¯Ø±Ø¬Ø©</label>
                            <input type="number" class="q-points w-full p-2 border rounded focus:ring-1 focus:ring-blue-500 outline-none text-center" value="${qData.points || 1}">
                        </div>
                    </div>

                    <div id="content-${id}" class="space-y-3 pt-2 border-t border-dashed">
                        </div>
                </div>
            `;
            
            listContainer.appendChild(card);
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
            renderContent(id, qData.type, qData);
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            renumberQuestions();
        }

        // === ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ ===
        function changeType(id, type) {
            renderContent(id, type);
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ¹Ù„ÙŠÙ…Ø§Øª
            const common = document.getElementById(`common-fields-${id}`);
            if(type === 'instructions') common.classList.add('hidden');
            else common.classList.remove('hidden');
        }

        // === Ø­Ø°Ù Ø³Ø¤Ø§Ù„ ===
        function deleteQuestion(id) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
                document.getElementById(`card-${id}`).remove();
                renumberQuestions();
                if(listContainer.children.length === 0) document.getElementById('empty-state').classList.remove('hidden');
            }
        }

        // === Ø·ÙŠ ÙˆØªÙˆØ³ÙŠØ¹ ===
        function toggleCollapse(id) {
            const body = document.getElementById(`body-${id}`);
            const icon = document.getElementById(`icon-collapse-${id}`);
            if (body.style.display === 'none') {
                body.style.display = 'block';
                icon.style.transform = 'rotate(0deg)';
            } else {
                body.style.display = 'none';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // === Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===
        function renumberQuestions() {
            const badges = document.querySelectorAll('.q-number');
            badges.forEach((badge, index) => {
                badge.textContent = `Ø³${index + 1}`;
            });
        }

        // === Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ) ===
        function renderContent(id, type, data = {}) {
            const container = document.getElementById(`content-${id}`);
            container.innerHTML = '';

            if (type === 'mcq') {
                const choices = data.choices || ['', '', '', ''];
                const correct = data.answer || '';
                
                let html = `<label class="text-xs font-bold text-gray-500">Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ø­Ø¯Ø¯ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¨Ø¬ÙˆØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©)</label>`;
                choices.forEach((choice, i) => {
                    html += `
                    <div class="flex items-center gap-2 mb-2 group">
                        <input type="radio" name="radio-${id}" value="${i}" ${choice === correct ? 'checked' : ''} class="w-5 h-5 text-blue-600 cursor-pointer">
                        <input type="text" class="mcq-choice w-full p-2 bg-gray-50 border border-gray-200 rounded text-sm focus:bg-white focus:border-blue-400 outline-none" value="${choice}" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± ${i+1}">
                        <button onclick="this.parentElement.remove()" class="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">âœ•</button>
                    </div>`;
                });
                html += `<button onclick="addChoiceOption(this, '${id}')" class="text-xs text-blue-600 font-bold hover:underline">+ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø¢Ø®Ø±</button>`;
                container.innerHTML = html;
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ checked Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†ØµÙŠØ© Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
                if(correct) {
                     const inputs = container.querySelectorAll('.mcq-choice');
                     inputs.forEach((input, idx) => {
                         if(input.value === correct) container.querySelectorAll(`input[type="radio"]`)[idx].checked = true;
                     });
                }

            } else if (type === 'tf') {
                const isTrue = data.answer === 'ØµØ­';
                container.innerHTML = `
                    <label class="text-xs font-bold text-gray-500 mb-2 block">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 p-3 border rounded-lg cursor-pointer bg-gray-50 hover:bg-green-50 peer-checked:bg-green-100">
                            <input type="radio" name="tf-${id}" value="ØµØ­" ${isTrue ? 'checked' : ''} class="text-green-600 w-5 h-5">
                            <span class="font-bold">ØµØ­</span>
                        </label>
                        <label class="flex items-center gap-2 p-3 border rounded-lg cursor-pointer bg-gray-50 hover:bg-red-50">
                            <input type="radio" name="tf-${id}" value="Ø®Ø·Ø£" ${!isTrue && data.answer ? 'checked' : ''} class="text-red-600 w-5 h-5">
                            <span class="font-bold">Ø®Ø·Ø£</span>
                        </label>
                    </div>
                `;

            } else if (type === 'essay') {
                container.innerHTML = `
                    <label class="text-xs font-bold text-gray-500">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© (Ù„Ù„Ù…ØµØ­Ø­)</label>
                    <textarea class="essay-answer w-full p-3 border rounded-lg focus:ring-1 focus:ring-blue-500 outline-none h-24 text-sm" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù‡Ù†Ø§...">${data.answer || ''}</textarea>
                `;

            } else if (type === 'instructions') {
                container.innerHTML = `
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" class="inst-title w-full p-2 border rounded font-bold text-blue-800" value="${data.mainTitle || ''}" placeholder="Ù…Ø«Ø§Ù„: Ø«Ø§Ù†ÙŠØ§Ù‹: Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ©">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500">Ø§Ù„ÙˆØµÙ / Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</label>
                            <textarea class="inst-desc w-full p-2 border rounded bg-yellow-50 text-sm" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¯Ù‚Ø©...">${data.description || ''}</textarea>
                        </div>
                    </div>
                `;
            }
        }

        // Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù€ MCQ
        function addChoiceOption(btn, id) {
            const div = document.createElement('div');
            div.className = 'flex items-center gap-2 mb-2 group';
            div.innerHTML = `
                <input type="radio" name="radio-${id}" class="w-5 h-5 text-blue-600 cursor-pointer">
                <input type="text" class="mcq-choice w-full p-2 bg-gray-50 border border-gray-200 rounded text-sm focus:bg-white focus:border-blue-400 outline-none" placeholder="Ø®ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯">
                <button onclick="this.parentElement.remove()" class="text-gray-300 hover:text-red-500 opacity-100 transition">âœ•</button>
            `;
            btn.insertAdjacentElement('beforebegin', div);
        }

        // === Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (YAML) ===
        function generateYAML() {
            const title = document.getElementById('meta-title').value;
            const subject = document.getElementById('meta-subject').value;
            const code = document.getElementById('meta-code').value;

            if(!title) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'); return; }

            const questions = [];
            const cards = listContainer.querySelectorAll('.question-card');

            cards.forEach(card => {
                const type = card.querySelector('select').value;
                const id = card.id.replace('card-', '');
                let qObj = { type: type };

                if (type !== 'instructions') {
                    qObj.question = card.querySelector('.q-text').value;
                    qObj.points = parseInt(card.querySelector('.q-points').value) || 1;
                }

                if (type === 'mcq') {
                    const choiceInputs = card.querySelectorAll('.mcq-choice');
                    const radios = card.querySelectorAll('input[type="radio"]');
                    qObj.choices = Array.from(choiceInputs).map(i => i.value).filter(v => v.trim() !== '');
                    
                    let selectedIdx = -1;
                    radios.forEach((r, i) => { if(r.checked) selectedIdx = i; });
                    
                    if (selectedIdx > -1 && qObj.choices[selectedIdx]) {
                        qObj.answer = qObj.choices[selectedIdx];
                    } else {
                        qObj.answer = ""; // Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø¥Ø¬Ø§Ø¨Ø©
                    }
                } else if (type === 'tf') {
                    qObj.choices = ['ØµØ­', 'Ø®Ø·Ø£'];
                    const checked = card.querySelector('input[type="radio"]:checked');
                    qObj.answer = checked ? checked.value : '';
                } else if (type === 'essay') {
                    qObj.answer = card.querySelector('.essay-answer').value;
                } else if (type === 'instructions') {
                    const mTitle = card.querySelector('.inst-title').value;
                    if(mTitle) qObj.mainTitle = mTitle;
                    qObj.description = card.querySelector('.inst-desc').value;
                }

                questions.push(qObj);
            });

            const finalObj = {
                title: title,
                "subject-name": subject,
                "subject-code": code,
                questions: questions
            };

            const yamlStr = jsyaml.dump(finalObj);
            document.getElementById('exportText').value = yamlStr;
            document.getElementById('exportModal').classList.remove('hidden');
        }

        // === Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ===
        function processImport() {
            const text = document.getElementById('importText').value;
            try {
                const obj = jsyaml.load(text);
                const data = Array.isArray(obj) ? obj[0] : obj; // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØµÙŠØºØªÙŠÙ† (Ù…ØµÙÙˆÙØ© Ø£Ùˆ ÙƒØ§Ø¦Ù†)

                document.getElementById('meta-title').value = data.title || '';
                document.getElementById('meta-subject').value = data['subject-name'] || '';
                document.getElementById('meta-code').value = data['subject-code'] || '';

                listContainer.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ
                questionCount = 0;

                if (data.questions) {
                    data.questions.forEach(q => addQuestion(q));
                }

                document.getElementById('importModal').classList.add('hidden');
            } catch (e) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙˆØ¯ YAML. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµÙŠØºØ©.\n' + e.message);
            }
        }

        function copyToClipboard() {
            const copyText = document.getElementById("exportText");
            copyText.select();
            document.execCommand("copy");
            alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
        }

        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
        window.onload = function() {
           // ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
           // addQuestion(); 
        }

    </script>
</body>
</html>
