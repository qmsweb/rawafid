<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงูุงุฎุชุจุงุฑุงุช ุงูุฏููุงูููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f3f4f6; }
        .editor-area { font-family: 'Courier New', Courier, monospace; direction: ltr; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto space-y-6">
        
        <header class="bg-white p-6 rounded-lg shadow-sm border-r-4 border-blue-600 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">ูููุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูุฐูู</h1>
                <p class="text-sm text-gray-500 mt-1">ูุนุชูุฏ ุนูู ูููููุฉ YAML</p>
            </div>
            <button onclick="toggleEditor()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุงุฎุชุจุงุฑ
            </button>
        </header>

        <section id="configPanel" class="bg-white p-6 rounded-lg shadow-sm hidden">
            <h2 class="text-lg font-bold mb-4 text-gray-700">ููุฏ ุงูุงุฎุชุจุงุฑ (YAML)</h2>
            <p class="text-sm text-gray-500 mb-2">ููููู ุชุนุฏูู ุงูุฃุณุฆูุฉุ ุงูุฏุฑุฌุงุชุ ุฃู ุงูุชุฑุชูุจ ููุง ูุจุงุดุฑุฉ.</p>
            <textarea id="yamlInput" class="editor-area w-full h-96 p-4 bg-gray-900 text-green-400 rounded-md text-sm border focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
            <div class="mt-4 flex justify-end">
                <button onclick="loadQuiz()" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition">
                    ุชุญุฏูุซ ูุจุฏุก ุงูุงุฎุชุจุงุฑ
                </button>
            </div>
        </section>

        <main id="quizContainer" class="space-y-6">
            </main>

        <div id="actionButtons" class="hidden sticky bottom-4 bg-white p-4 rounded-lg shadow-lg border border-gray-200 flex justify-between items-center z-50">
            <div class="text-gray-600 text-sm">
                ุนุฏุฏ ุงูุฃุณุฆูุฉ: <span id="qCount" class="font-bold">0</span>
            </div>
            <button onclick="submitExam()" class="bg-green-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-green-700 shadow-md transition transform hover:-translate-y-1">
                ุฅููุงุก ุงูุงุฎุชุจุงุฑ ูุนุฑุถ ุงููุชูุฌุฉ
            </button>
        </div>

        <section id="resultPanel" class="hidden bg-white p-6 rounded-lg shadow-lg border-t-4 border-green-500">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <div class="text-sm text-gray-500">ุงูุฏุฑุฌุฉ ุงููููุฉ (ููููุถูุนู)</div>
                    <div id="scoreDisplay" class="text-3xl font-bold text-blue-600 mt-1">-</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg text-center">
                    <div class="text-sm text-gray-500">ุญุงูุฉ ุงูุงุฎุชุจุงุฑ</div>
                    <div class="text-xl font-bold text-purple-600 mt-1">ุชู ุงูุชุณููู</div>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ููู ุงููุชูุฌุฉ (YAML)</label>
                <div class="relative">
                    <textarea id="resultOutput" readonly class="editor-area w-full h-64 p-4 bg-gray-100 text-gray-800 rounded-md text-sm border resize-none"></textarea>
                    <button onclick="copyResult()" class="absolute top-2 left-2 bg-white border border-gray-300 px-3 py-1 rounded text-xs hover:bg-gray-50">
                        ูุณุฎ ุงูููุฏ
                    </button>
                </div>
            </div>
            
            <button onclick="location.reload()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300">
                ุฅุฌุฑุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ
            </button>
        </section>

    </div>

    <script>
        // 1. ุงูุจูุงูุงุช ุงูุฃูููุฉ (ุงูุชู ุฒูุฏุชูู ุจูุง)
        const defaultYaml = `title: ุงุฎุชุจุงุฑ ูู ุงูุฃุณุงุณ ุงููุนุฑูู ูููููุฌ
subject-name: ููุงูุฌ ุงููุบุฉ ุงูุนุฑุจูุฉ
subject-code: EDUC431
questions:
  - type: instructions
    mainTitle: "ุฃูููุง: ุงูุฃุณุฆูุฉ ุงูููุถูุนูุฉ (ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ)"
    description: ุงุฎุชุฑ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ูู ุจูู ุงูุจุฏุงุฆู ุงููุนุทุงุฉ
  - type: mcq
    question: "ุงููุธุฑุฉ ุงูุชู ุชุฑู ุฃู ุงููุนุฑูุฉ 'ุบุงูุฉ ูู ุฐุงุชูุง' ูุถุฑูุฑูุฉ ูุจูุงุก ุงููุฏุฑุงุช ุงูุนูููุฉ ูู ุงููุธุฑุฉ:"
    points: 1
    choices:
      - ุงููุธูููุฉ
      - ุงูุจูุงุฆูุฉ
      - ุงูุชูููููุฉ
      - ุงูููุณููุฉ
    answer: ุงูุจูุงุฆูุฉ
  - type: mcq
    question: "ุธูุฑ 'ุงููููุฌ ุงููุญูุฑู' ุงูุฐู ูุชูุญูุฑ ุญูู ูุดููุงุช ูุฌุชูุนูุฉ ูุชูุฌุฉ ูููุธุฑุฉ:"
    points: 1
    choices:
      - ุงูุจูุงุฆูุฉ ุงูุตุฑูุฉ
      - ุงููุธูููุฉ ุงูุตุฑูุฉ
      - ุงูุชูููููุฉ (ุงููุฑูุจุฉ)
      - ุงูุนุดูุงุฆูุฉ
    answer: ุงูุชูููููุฉ (ุงููุฑูุจุฉ)
  - type: mcq
    question: "ูููุงู ูููุฑูู ุงูุซุงูู ูู ุงููุธุฑุฉ ุงูุฅุณูุงููุฉุ ูุฅู ุงููุนุฑูุฉ:"
    points: 1
    choices:
      - ูุทุฑูุฉ ุชูููููุฉ ูุงููุฉ
      - ููุชุณุจุฉ ูููุณุช ูุทุฑูุฉ
      - ูุณุชุญููุฉ ุงููุตูู ุฅูููุง
      - ูุงุตุฑุฉ ุนูู ุงูุญูุงุณ ููุท
    answer: ููุชุณุจุฉ ูููุณุช ูุทุฑูุฉ
  - type: mcq
    question: "ุงููุนูุงุฑ ุงูุญุฏูุซ ููุชููู ูู ุชุฏุฑูุณ ุจููุฉ ุงููุนุฑูุฉ ุฃุตุจุญ ูุชูุซู ูู:"
    points: 1
    choices:
      - ุญูุธ ุฃูุจุฑ ูุฏุฑ ูู ุงููุนูููุงุช
      - ุงูุชูุงู ุงูููุงุฑุงุช ูุงุณุชุฎุฏุงููุง
      - ุณุฑุนุฉ ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ
      - ุงูุงูุชุฒุงู ุจุงูุญุถูุฑ ุงููุฏุฑุณู
    answer: ุงูุชูุงู ุงูููุงุฑุงุช ูุงุณุชุฎุฏุงููุง
  - type: mcq
    question: ุฃู ูู ุงูุชุงูู ููุนุฏ ูู ุชุตูููุงุช ุงููุนุฑูุฉ ุญุณุจ 'ูุณุงุฆู ุฅุฏุฑุงููุง'ุ
    points: 1
    choices:
      - ุญูุงุฆู ูููุงููู
      - ูุนุงุฑู ุนูููุฉ ูููุงุฑูุฉ
      - ูุนุงุฑู ุชุฏุฑู ุจุงูุญุฏุณ ูุงููุญู
      - ูุนุงุฑู ูุธุฑูุฉ ูุนูููุฉ
    answer: ูุนุงุฑู ุชุฏุฑู ุจุงูุญุฏุณ ูุงููุญู
  - type: mcq
    question: ูุง ุงูุฐู ูููุฒ ุงููุฏุฑุณุฉ ุนู ุงููุฌุชูุน ุงููุญูุท ุจูุง ูููุงู ูููููู ุงูุฃุณุงุณ ุงููุนุฑููุ
    points: 1
    choices:
      - ุงููุจุงูู ูุงูุชุฌููุฒุงุช
      - ุงููุนุฑูุฉ ุงูููุธูุฉ ุงูููุฏูุฉ ููุทูุงุจ
      - ุงูุฃูุดุทุฉ ุงูุฑูุงุถูุฉ
      - ุงูููุงููู ุงูุตุงุฑูุฉ
    answer: ุงููุนุฑูุฉ ุงูููุธูุฉ ุงูููุฏูุฉ ููุทูุงุจ
  - type: mcq
    question: "ูุฑูุฒ ุฃุตุญุงุจ ุงููุธุฑุฉ ุงููุธูููุฉ ูููุนุฑูุฉ ุนูู:"
    points: 1
    choices:
      - ูููุฉ ุงููุนุฑูุฉ ุงููุญููุธุฉ
      - ุทุฑููุฉ ุงูุญุตูู ุนูู ุงููุนุฑูุฉ ูุญู ุงููุดููุงุช
      - ุงูุชุฑุงุซ ุงููุฏูู
      - ุงูุชูุธููุงุช ุงููุนุฑููุฉ ููููุงุฏ
    answer: ุทุฑููุฉ ุงูุญุตูู ุนูู ุงููุนุฑูุฉ ูุญู ุงููุดููุงุช
  - type: instructions
    mainTitle: "ุซุงูููุง: ุงูุฃุณุฆูุฉ ุงูููุถูุนูุฉ (ุตูุงุจ ุฃู ุฎุทุฃ)"
    description: ุญุฏุฏ ูุฏู ุตุญุฉ ุงูุนุจุงุฑุงุช ุงูุชุงููุฉ
  - type: tf
    question: ุงููุนุฑูุฉ ูู ูุชุงุฌ ุงูุฌูุฏ ุงูุฅูุณุงูู ูุชูุณูุฑ ุงูุธูุงูุฑุ ูุชุดูู ุงููุนุชูุฏุงุช ูุงูุชุตูุฑุงุช ูุงูุฃุญูุงู.
    points: 1
    choices:
      - ุตุญ
      - ุฎุทุฃ
    answer: ุตุญ
  - type: tf
    question: ุชุฑู ุงููุธุฑุฉ ุงูุจูุงุฆูุฉ ูููุนุฑูุฉ ุฃููุง ูุณููุฉ ูููุณุช ุบุงูุฉุ ูุฐุง ุฑูุฒุช ุนูู ุงูุฃูุดุทุฉ.
    points: 1
    choices:
      - ุตุญ
      - ุฎุทุฃ
    answer: ุฎุทุฃ
  - type: tf
    question: ููุชุตุฑ ุงุฎุชูุงุฑ ุงููุนุฑูุฉ ุงูููุงุณุจุฉ ูููููุฌ ุนูู ุขุฑุงุก ุงูุฎุจุฑุงุก ูุงููุนูููู ููุท ุฏูู ุงูุฑุฌูุน ููุทูุงุจ ุฃู ุฃูููุงุก ุงูุฃููุฑ.
    points: 1
    choices:
      - ุตุญ
      - ุฎุทุฃ
    answer: ุฎุทุฃ
  - type: tf
    question: ูู ุงูุชูุฌูุงุช ุงูุนูููุฉ ุงูุญุฏูุซุฉ ูุดุฑ ุงููุนุฑูุฉ ุงููููุฉ ูุงูููููุฉ ุจูุตููุง ุงูุฃูุซุฑ ููุงุกูุฉ ูุฑูุญ ุงูุนุตุฑ.
    points: 1
    choices:
      - ุตุญ
      - ุฎุทุฃ
    answer: ุตุญ
  - type: tf
    question: ุงููุฑูู ุงูุฃูู ูู ุงููุธุฑุฉ ุงูุฅุณูุงููุฉ ูุฑู ุฃู ุงููุนุฑูุฉ ููุฌูุฏุฉ ูููุง ูุฏู ุงูุฅูุณุงู ุญูู ูููุฏ ูููููุง ูุงููุฉ.
    points: 1
    choices:
      - ุตุญ
      - ุฎุทุฃ
    answer: ุตุญ
  - type: tf
    question: ุงูุฃุณุงุณ ุงููุนุฑูู ูู ุนูุตุฑ ุซุงููู ูู ุงููููุฌ ููููู ุงูุงุณุชุบูุงุก ุนูู.
    points: 1
    choices:
      - ุตุญ
      - ุฎุทุฃ
    answer: ุฎุทุฃ
  - type: instructions
    mainTitle: "ุซุงูุซูุง: ุงูุฃุณุฆูุฉ ุงูููุงููุฉ ูุงูุชุทุจูููุฉ"
    description: ุฃุฌุจ ุนู ุงูุฃุณุฆูุฉ ุงูุชุงููุฉ ูุจูุงู ุงูููู ูุงููุฏุฑุฉ ุนูู ุงูุชุทุจูู
  - type: essay
    question: "ูุงุฑู ุจูู 'ุงููุธุฑุฉ ุงูุจูุงุฆูุฉ' ู 'ุงููุธุฑุฉ ุงููุธูููุฉ' ูููุนุฑูุฉ ูู ุญูุซ: (ุงูุบุงูุฉ ูู ุงููุนุฑูุฉ) ู (ููุน ุงูููุงูุฌ ุงูุชู ูุชุฌุช ุนููุง)."
    points: 3
    answer: |-
      - ุงููุธุฑุฉ ุงูุจูุงุฆูุฉ: ุชุฑู ุงููุนุฑูุฉ ุบุงูุฉ ูู ุฐุงุชูุง ูุจูุงุก ุงููุฏุฑุงุช ุงูุนูููุฉุ ููุชุฌ ุนููุง ููุงูุฌ ุงูุชูุธููุงุช ุงููุนุฑููุฉ.
      - ุงููุธุฑุฉ ุงููุธูููุฉ: ุชุฑู ุงููุนุฑูุฉ ูุณููุฉ ูุญู ุงููุดููุงุช ูููุณุช ุบุงูุฉุ ููุชุฌ ุนููุง ููุงูุฌ ุชุชูุฑูุฒ ุญูู ุงูุฃูุดุทุฉ ูุงูุฎุจุฑุงุช.
  - type: essay
    question: ููู ูููู ูููููุฌ ุชูููุฉ 'ุงูุฎูุงู ุงูุนููู' ูุฏู ุงูุทูุงุจ ูุฃุญุฏ ุงูุชูุฌูุงุช ุงูุญุฏูุซุฉุ
    points: 2
    answer: ูู ุฎูุงู ูุชุงุจุฉ ุงูุชูุงุฑูุฑ ุนู ุชุบูุฑุงุช ูู ูุฌุงูุงุช ูุนููุฉุ ูุฅุซุงุฑุฉ ุชุณุงุคูุงุช ุชุญูุฒ ุงูุชุฎูู ุญูู ุงููุณุชูุจู ูุงูุธูุงูุฑ.
  - type: essay
    question: ููุงุฌู ูุงุถุนู ุงูููุงูุฌ ูุดููุฉ ูู ุงุฎุชูุงุฑ ุงููุนุฑูุฉ ุจุณุจุจ ุบุฒุงุฑุชูุง. ุนุฏุฏ ุฃุฑุจุนุฉ ูุตุงุฏุฑ ูุงุฎุชูุงุฑ ุงููุนุฑูุฉ ุงูููุงุณุจุฉ.
    points: 3
    answer: |-
      1. ูุชุงุฆุฌ ุงูุจุญูุซ ูุงูุฏุฑุงุณุงุช ุงูุนูููุฉ.
      2. ูุฌูุฉ ูุธุฑ ุงูุฎุจุฑุงุก ูุงููุฎุชุตูู.
      3. ูุฌูุฉ ูุธุฑ ุงููุนูููู ูุงูุทูุงุจ.
      4. ูุฌูุฉ ูุธุฑ ุฃุตุญุงุจ ูุทุงุนุงุช ุงูุนูู.
  - type: essay
    question: ุงุดุฑุญ ุจุงุฎุชุตุงุฑ ุฑุฃู 'ุงููุฑูู ุงูุซุงูู' ูู ุงููุธุฑุฉ ุงูุฅุณูุงููุฉ ูููุนุฑูุฉุ ูููู ููุณุฌู ูุฐุง ุงูุฑุฃู ูุน ุงูุชุฑุจูุฉ ุงูุญุฏูุซุฉุ
    points: 3
    answer: ูุฑู ูุฐุง ุงููุฑูู ุฃู ุงููุนุฑูุฉ ููุชุณุจุฉ ูููุณุช ูุทุฑูุฉ (ุฃุฎุฑุฌูู ูู ุจุทูู ุฃููุงุชูู ูุง ุชุนูููู ุดูุฆุงู)ุ ูููุณุฌู ูุฐุง ูุน ุงูุชุฑุจูุฉ ุงูุญุฏูุซุฉ ุงูุชู ุชุคูุฏ ุนูู ุฅูุฌุงุจูุฉ ุงููุชุนูู ููุดุงุทู ูู ุงูุชุณุงุจ ุงูุฎุจุฑุงุช.
  - type: essay
    question: ูุง ูู ุงูุฃุณุฆูุฉ ุงูุฃุฑุจุนุฉ ุงูุชู ูุฌุจ ุฃู ูุณุฃููุง ูุงุถุน ุงููููุฌ ูููุณู ุนูุฏ ุงูุชุนุงูู ูุน ุงูุฃุณุงุณ ุงููุนุฑููุ
    points: 2
    answer: |-
      1. ูุง ุทุจูุนุฉ ุงููุนุฑูุฉ ุงูุชู ูุฌุจ ุฃู ูุดุชูู ุนูููุง ุงููููุฌุ
      2. ูุง ูุตุงุฏุฑ ุงูุญุตูู ุนูููุงุ
      3. ููู ูููู ูููููุฌ ุฃู ูุญูููุงุ
      4. ูุง ุฃููุงุน ุงููุนุงุฑู ุงูุชู ููุง ูููุฉ ุชุนููููุฉุ
  - type: essay
    question: ูู ุงูุชูุฌูุงุช ุงูุญุฏูุซุฉ 'ุชูููุฉ ุงููุธุฑุฉ ุงููููุฉ ูููุนุฑูุฉ'. ููู ูููู ุชุทุจูู ุฐูู ุฏุงุฎู ุงููููุฌุ
    points: 2
    answer: ูุชู ุฐูู ูู ุฎูุงู ุฅุจุฑุงุฒ ุงูุนูุงูุงุช ุจูู ุงูููุถูุนุงุช ุงููุฎุชููุฉุ ูุฅุชุงุญุฉ ุงููุฑุตุฉ ููุชุฃูู ูู ุงููุนุฑูุฉ ูููุงูุดุชูุง ูุชูููู ุนูุงูุงุช ุฌุฏูุฏุฉ ุจูููุงุ ุจุฏูุงู ูู ุชูุฏูููุง ูุฌุฒุฑ ููุนุฒูุฉ.
  - type: instructions
    description: ุงูููู ุฅูู ุฃุณุฃูู ููู ุงููุจูููุ ูุญูุธ ุงููุฑุณูููุ ูุฅููุงู ุงูููุงุฆูุฉ ุงูููุฑุจูู`;

        let currentQuizData = null;

        // ุชููุฆุฉ ุงูุตูุญุฉ
        window.onload = function() {
            document.getElementById('yamlInput').value = defaultYaml;
            loadQuiz();
        };

        function toggleEditor() {
            const panel = document.getElementById('configPanel');
            panel.classList.toggle('hidden');
        }

        // 2. ุฏุงูุฉ ุชุญููู ูุจูุงุก ุงูุงุฎุชุจุงุฑ
        function loadQuiz() {
            const yamlText = document.getElementById('yamlInput').value;
            const container = document.getElementById('quizContainer');
            container.innerHTML = ''; // ุชูุธูู

            try {
                // ุชุญููู YAML ุฅูู ูุงุฆู JS
                currentQuizData = jsyaml.load(yamlText);

                // ุจูุงุก ุงูุชุฑููุณุฉ
                const header = document.createElement('div');
                header.className = 'bg-white p-6 rounded-lg shadow-sm mb-6';
                header.innerHTML = `
                    <h2 class="text-xl font-bold text-gray-800">${currentQuizData.title || 'ุงุฎุชุจุงุฑ'}</h2>
                    <div class="flex gap-4 mt-2 text-sm text-gray-500">
                        <span>๐ ุงููุงุฏุฉ: ${currentQuizData['subject-name']}</span>
                        <span>๐ท๏ธ ุงูุฑูุฒ: ${currentQuizData['subject-code']}</span>
                    </div>
                `;
                container.appendChild(header);

                let questionCounter = 0;

                // ุงูุชูุฑุงุฑ ุนูู ุงูุนูุงุตุฑ (ุฃุณุฆูุฉ ุฃู ุชุนูููุงุช)
                currentQuizData.questions.forEach((item, index) => {
                    if (item.type === 'instructions') {
                        // ุนุฑุถ ุงูุชุนูููุงุช ุงููุงุตูุฉ
                        const div = document.createElement('div');
                        div.className = 'bg-blue-50 border-r-4 border-blue-400 p-4 rounded-md my-6';
                        div.innerHTML = `
                            ${item.mainTitle ? `<h3 class="font-bold text-blue-900 text-lg mb-1">${item.mainTitle}</h3>` : ''}
                            <p class="text-blue-800">${item.description}</p>
                        `;
                        container.appendChild(div);
                    } else {
                        // ุนุฑุถ ุงูุฃุณุฆูุฉ
                        questionCounter++;
                        const qDiv = document.createElement('div');
                        qDiv.className = 'bg-white p-6 rounded-lg shadow-sm border border-gray-100 question-block';
                        qDiv.dataset.id = index;
                        qDiv.dataset.type = item.type;
                        qDiv.dataset.points = item.points;

                        let contentHtml = `
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="font-bold text-gray-800 text-lg leading-relaxed">
                                    <span class="text-blue-600 ml-2">ุณ${questionCounter}.</span> ${item.question}
                                </h3>
                                <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded border">${item.points} ุฏุฑุฌุงุช</span>
                            </div>
                        `;

                        // ุฎูุงุฑุงุช ุงููุชุนุฏุฏ ูุงูุตูุงุจ/ุฎุทุฃ
                        if (item.type === 'mcq' || item.type === 'tf') {
                            contentHtml += `<div class="space-y-3 mt-4">`;
                            item.choices.forEach((choice, cIndex) => {
                                const choiceId = `q${index}_c${cIndex}`;
                                contentHtml += `
                                    <label class="flex items-center p-3 rounded-lg border border-gray-200 cursor-pointer hover:bg-blue-50 transition">
                                        <input type="radio" name="q_${index}" value="${choice}" class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300">
                                        <span class="mr-3 text-gray-700 select-none">${choice}</span>
                                    </label>
                                `;
                            });
                            contentHtml += `</div>`;
                        } else if (item.type === 'essay') {
                            contentHtml += `
                                <textarea name="q_${index}" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none mt-2" placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง..."></textarea>
                            `;
                        }

                        qDiv.innerHTML = contentHtml;
                        container.appendChild(qDiv);
                    }
                });

                document.getElementById('qCount').innerText = questionCounter;
                document.getElementById('actionButtons').classList.remove('hidden');
                document.getElementById('resultPanel').classList.add('hidden');
                document.getElementById('configPanel').classList.add('hidden');
                
            } catch (e) {
                alert('ุฎุทุฃ ูู ููุฏ YAML:\n' + e.message);
            }
        }

        // 3. ุฏุงูุฉ ุงูุชุตุญูุญ ูุชูููุฏ ุงููุชูุฌุฉ
        function submitExam() {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅููุงุก ุงูุงุฎุชุจุงุฑ ูุชุณููููุ')) return;

            let totalScore = 0;
            let earnedScore = 0;
            const answersList = [];

            const questionBlocks = document.querySelectorAll('.question-block');
            
            questionBlocks.forEach(block => {
                const index = block.dataset.id;
                const type = block.dataset.type;
                const points = parseFloat(block.dataset.points);
                const qData = currentQuizData.questions[index];
                
                let studentAnswer = "";
                let isCorrect = false;

                // ุฌูุน ุงูุฅุฌุงุจุงุช
                if (type === 'mcq' || type === 'tf') {
                    const selected = block.querySelector(`input[name="q_${index}"]:checked`);
                    if (selected) {
                        studentAnswer = selected.value;
                        if (studentAnswer === qData.answer) {
                            isCorrect = true;
                            earnedScore += points;
                        }
                    }
                } else if (type === 'essay') {
                    const textInput = block.querySelector(`textarea`);
                    studentAnswer = textInput.value;
                    // ุงูุฃุณุฆูุฉ ุงูููุงููุฉ ุชุญุชุงุฌ ุชุตุญูุญ ูุฏููุ ูุนุชุจุฑูุง "ุชุญุชุงุฌ ูุฑุงุฌุนุฉ"
                    isCorrect = "manual_review"; 
                }

                if(type !== 'essay') totalScore += points;

                // ุชุณุฌูู ุงูุจูุงูุงุช ูููุงูู
                answersList.push({
                    question_number: answersList.length + 1,
                    question_text: qData.question,
                    student_answer: studentAnswer,
                    correct_answer: qData.answer,
                    is_correct: isCorrect,
                    points_earned: isCorrect === true ? points : 0
                });

                // ุชูููู ุงูุฅุฌุงุจุงุช ูู ุงููุงุฌูุฉ (ุชุบุฐูุฉ ุฑุงุฌุนุฉ)
                if(type !== 'essay') {
                    block.classList.add(isCorrect ? 'border-green-500' : 'border-red-500', 'border-2');
                    if (!isCorrect) {
                        const feedback = document.createElement('div');
                        feedback.className = 'mt-3 p-2 bg-red-50 text-red-700 text-sm rounded';
                        feedback.innerHTML = `<strong>ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ:</strong> ${qData.answer}`;
                        block.appendChild(feedback);
                    }
                } else {
                    const feedback = document.createElement('div');
                    feedback.className = 'mt-3 p-3 bg-yellow-50 text-yellow-800 text-sm rounded border border-yellow-200';
                    feedback.innerHTML = `<strong>ุงูุฅุฌุงุจุฉ ุงููููุฐุฌูุฉ:</strong><br> ${qData.answer.replace(/\n/g, '<br>')}`;
                    block.appendChild(feedback);
                }
                
                // ุชุนุทูู ุงูุฅุฏุฎุงู
                const inputs = block.querySelectorAll('input, textarea');
                inputs.forEach(input => input.disabled = true);
            });

            // ุนุฑุถ ุงููุชุงุฆุฌ
            document.getElementById('actionButtons').classList.add('hidden');
            const resultPanel = document.getElementById('resultPanel');
            resultPanel.classList.remove('hidden');
            document.getElementById('scoreDisplay').innerText = `${earnedScore} / ${totalScore}`;
            
            // ุงูุงูุชูุงู ููุฃุณูู
            resultPanel.scrollIntoView({ behavior: 'smooth' });

            // ุชูููุฏ YAML ุงููุชูุฌุฉ
            const resultObj = {
                exam_info: {
                    title: currentQuizData.title,
                    subject: currentQuizData['subject-name'],
                    date: new Date().toLocaleDateString('ar-EG')
                },
                score_summary: {
                    objective_score: `${earnedScore}/${totalScore}`,
                    note: "ุงูุฃุณุฆูุฉ ุงูููุงููุฉ ุชุญุชุงุฌ ูุฑุงุฌุนุฉ ูุฏููุฉ"
                },
                student_submission: answersList
            };

            const resultYaml = jsyaml.dump(resultObj);
            document.getElementById('resultOutput').value = resultYaml;
        }

        function copyResult() {
            const copyText = document.getElementById("resultOutput");
            copyText.select();
            document.execCommand("copy");
            alert("ุชู ูุณุฎ ุงููุชูุฌุฉ ุจูุฌุงุญ!");
        }
    </script>
</body>
</html>
