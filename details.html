<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تفاصيل المادة - روافد</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100..900&display=swap" rel="stylesheet"> 
  <link rel="icon" href="images/favicon.png" type="image/jpg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="topbar.css" /> <style>
    /* ... (استخدم نفس الـ CSS الموجود في صفحتك الرئيسية لضمان التناسق) ... */
    /* سأضع هنا التنسيقات الضرورية فقط */
    :root { --primary-color: #1a2ac6; --light-bg: #f4f6fb; }
    body { font-family: "Noto Kufi Arabic", sans-serif; background-color: var(--light-bg); padding: 20px; padding-top: 80px; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
    
    .item-header { border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
    .item-title { font-size: 1.8rem; color: #333; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .item-meta { color: #666; font-size: 0.9rem; margin-bottom: 15px; }
    
    .description-box { background: #f9f9f9; padding: 20px; border-radius: 10px; line-height: 1.8; color: #444; margin-bottom: 30px; white-space: pre-wrap; }
    
    .image-container img { max-width: 100%; border-radius: 10px; margin-bottom: 20px; }
    
    .actions-bar { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
    
    .btn { padding: 12px 25px; border-radius: 8px; text-decoration: none; color: white; display: inline-flex; align-items: center; gap: 8px; transition: 0.3s; cursor: pointer; border: none; font-size: 1rem; }
    .btn-download { background-color: var(--primary-color); }
    .btn-download:hover { background-color: #1522a0; }
    .btn-preview { background-color: #e63946; }
    .btn-share { background-color: #2e8b57; }
    .btn-back { background-color: #6c757d; }

    /* أيقونة التحميل */
    .loading { text-align: center; padding: 50px; font-size: 1.2rem; color: #666; }
  </style>
</head>
<body>

  <div id="topbar-container"></div>

  <div class="container" id="content-area">
    <div class="loading"><i class="fas fa-spinner fa-spin"></i> جاري جلب التفاصيل...</div>
  </div>

<script>
  // دوال مساعدة (نفس الدوال السابقة)
  function getIconClass(type) {
    switch (type) {
      case 'documents': return 'fas fa-file-alt';
      case 'videos': return 'fab fa-youtube';
      case 'resources': return 'fas fa-bullhorn';
      case 'quizzes': return 'fas fa-question-circle';
      case 'links': return 'fas fa-globe';
      default: return 'fas fa-file';
    }
  }

  // المنطق الرئيسي
  document.addEventListener('DOMContentLoaded', () => {
    // جلب الباراميترات من الرابط (i = الكورس، id = رقم العنصر)
    const urlParams = new URLSearchParams(window.location.search);
    const courseCode = urlParams.get('i');
    const itemId = urlParams.get('id');

    const contentArea = document.getElementById('content-area');

    if (!courseCode || !itemId) {
      contentArea.innerHTML = '<p style="text-align:center; color:red">رابط غير صحيح. تأكد من الكود والمعرف.</p>';
      return;
    }

    // جلب ملف الـ JSON
    fetch(`assets/data/${courseCode}.json`)
      .then(res => {
         if (!res.ok) throw new Error("ملف البيانات غير موجود");
         return res.json();
      })
      .then(data => {
        // البحث عن العنصر الذي يحمل نفس الـ id
        // نستخدم == للمقارنة المرنة بين الرقم والنص
        const item = data.items.find(x => x.id == itemId); 

        if (!item) {
          contentArea.innerHTML = '<p style="text-align:center">عذراً، هذا العنصر غير موجود.</p>';
          return;
        }

        // تحديث عنوان الصفحة
        document.title = `${item.title} - ${data.name}`;

        // تجهيز الأزرار
        let buttonsHTML = '';
        
        // زر التحميل
        if (item.download_url) {
            buttonsHTML += `<a href="${item.download_url}" class="btn btn-download" download><i class="fas fa-download"></i> تحميل الملف</a>`;
        }

        // زر المعاينة/المشاهدة
        if (item.preview_url) {
            let btnText = item.type === 'videos' ? 'مشاهدة الفيديو' : 'معاينة';
            buttonsHTML += `<a href="${item.preview_url}" class="btn btn-preview" target="_blank"><i class="fas fa-eye"></i> ${btnText}</a>`;
        }

        // زر المشاركة
        buttonsHTML += `<button onclick="sharePage()" class="btn btn-share"><i class="fas fa-share-alt"></i> مشاركة</button>`;
        
        // زر العودة
        buttonsHTML += `<a href="index.html?i=${courseCode}" class="btn btn-back"><i class="fas fa-arrow-right"></i> عودة للمقرر</a>`;

        // تجهيز الصورة
        let imageHTML = item.image_url ? `<div class="image-container"><img src="${item.image_url}" alt="${item.title}"></div>` : '';

        // عرض المحتوى
        contentArea.innerHTML = `
            <div class="item-header">
                <div class="item-title">
                    <i class="${getIconClass(item.type)}" style="color: var(--primary-color);"></i>
                    ${item.title}
                </div>
                <div class="item-meta">المقرر: ${data.name} (${data.code})</div>
            </div>

            ${imageHTML}

            <div class="description-box">
                ${item.description || 'لا يوجد وصف متاح.'}
            </div>

            <div class="actions-bar">
                ${buttonsHTML}
            </div>
        `;

      })
      .catch(err => {
        contentArea.innerHTML = `<p style="text-align:center">حدث خطأ: ${err.message}</p>`;
      });
      
      // تحميل التوب بار (اختياري)
      fetch("topbar.html").then(r=>r.text()).then(h=> document.getElementById('topbar-container').innerHTML = h).catch(()=>{});
  });

  function sharePage() {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      }).catch(console.error);
    } else {
      navigator.clipboard.writeText(window.location.href);
      alert('تم نسخ رابط الصفحة!');
    }
  }
</script>
</body>
</html>
